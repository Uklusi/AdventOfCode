from AoCUtils import *
from intcode import Interpreter, readTape, prepareAsciiInput, asciiToChar

result = 0
partNumber = "2"

writeToLog = True
if writeToLog:
    logFile = open("log" + partNumber + ".txt", "w")
else:
    logFile = "stdout"
printLog = printLogFactory(logFile, printNewline=False)

""" Risolto AMMANO
............#############......................................
............#...........#......................................
............#.#############....................................
............#.#.........#.#....................................
............#.#.......#######..................................
............#.#.........#.#.#..................................
............#.#.........#.#.#.......................###########
............#.#.........#.#.#.......................#.........#
..###########.#.........#.#.#.......................#.........#
..#...........#.........#.#.#.......................#.........#
#############.#.........#.#.#.......................#.........#
#.#.........#.#.........#.#.#.......................#.........#
#.#.........#.###########.###########.....###########.........#
#.#.........#...............#.......#.....#...................#
#.#.........#...............###########.###########...........#
#.#.........#.......................#.#.#.#.......#...........#
#.#.........#.......................#.#.#.#.......#...........#
#.#.........#.......................#.#.#.#.......#...........#
#.#.........#.......................#.#.#.#.......#.###########
#.#.........#.......................#.#.#.#.......#.#..........
#.###########.......................#.#.#.#.......#.#..........
#...................................#.#.#.#.......#.#..........
########^...........................#######.......#.#..........
......................................#.#.........#.#..........
......................................#############.#..........
........................................#...........#..........
........................................#############..........

A: L,8,R,12,R,12,R,10
B: R,10,R,12,R,10
C: L,10,R,10,L,6
A,B,A,B,C,C,B,A,B,C
"""

intCodeTape = readTape("input.txt")
intCodeTape[0] = 2

mainRoutineStr = "A,B,A,B,C,C,B,A,B,C\n"
routineAStr = "L,8,R,12,R,12,R,10\n"
routineBStr = "R,10,R,12,R,10\n"
routineCStr = "L,10,R,10,L,6\n"
videoFeedStr = "y\n"

inputs = prepareAsciiInput([mainRoutineStr, routineAStr, routineBStr, routineCStr, videoFeedStr])

interpreter = Interpreter(intCodeTape=intCodeTape, inputs=inputs)

def outputCallback(output: int) -> None:
    global result
    try:
        printLog(asciiToChar(output))
    except:
        pass

    result = output
    

interpreter.setOutputCallback(outputCallback)

interpreter.run()

with open("output" + partNumber + ".txt", "w") as outputFile:
    outputFile.write(str(result))
    print(str(result))

if writeToLog:
    cast(TextIOWrapper, logFile).close()

